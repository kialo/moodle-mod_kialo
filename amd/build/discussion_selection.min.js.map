{"version":3,"file":"discussion_selection.min.js","sources":["../src/discussion_selection.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Javascript code for module instance settings form.\n *\n * @module      mod_kialo/discussion_selection\n * @copyright   2025 onwards, Kialo GmbH <support@kialo-edu.com>\n * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @param {string} deeplinkUrl - The url for discussion selection in Kialo\n */\n\nimport ModalFactory from 'core/modal_factory';\nimport {getString} from 'core/str';\n\n// TODO: use Modal for newer versions of Moodle? ModalFactory will be removed in 4.7 and 5.2\n// only support for moodle 4.0+\nexport const init = async(deeplinkUrl) => {\n    let modal;\n    document.getElementById('id_kialo_select_discussion').addEventListener('click', async() => {\n        modal = await ModalFactory.create({\n            title: await getString('select_discussion', 'mod_kialo'),\n            body: `<iframe class=\"kialo-iframe\" src=\"${deeplinkUrl}\"></iframe>`,\n            large: true,\n        });\n        modal.show();\n    });\n\n    window.addEventListener(\n        'message',\n        (event) => {\n            if (event.data.type !== 'kialo_discussion_selected') {\n                return;\n            }\n\n            // Fill in the deep-linked details.\n            document.querySelector('input[name=discussion_url]').value = event.data.discussionurl;\n            document.querySelector('input[name=discussion_title]').value = event.data.discussiontitle;\n\n            // Prefill activity name based on discussion title if user hasn't entered one yet.\n            const nameInput = document.querySelector('input[name=name]');\n            if (!nameInput.value) {\n                nameInput.value = event.data.discussiontitle;\n            }\n\n            if (modal) {\n                modal.hide();\n                modal.destroy();\n            }\n        }\n    );\n};\n"],"names":["async","modal","document","getElementById","addEventListener","ModalFactory","create","title","body","deeplinkUrl","large","show","window","event","data","type","querySelector","value","discussionurl","discussiontitle","nameInput","hide","destroy"],"mappings":";;;;;;;;sKA6BoBA,MAAAA,kBACZC,MACJC,SAASC,eAAe,8BAA8BC,iBAAiB,SAASJ,UAC5EC,YAAcI,uBAAaC,OAAO,CAC9BC,YAAa,kBAAU,oBAAqB,aAC5CC,KAAO,qCAAoCC,yBAC3CC,OAAO,IAEXT,MAAMU,UAGVC,OAAOR,iBACH,WACCS,WAC2B,8BAApBA,MAAMC,KAAKC,YAKfb,SAASc,cAAc,8BAA8BC,MAAQJ,MAAMC,KAAKI,cACxEhB,SAASc,cAAc,gCAAgCC,MAAQJ,MAAMC,KAAKK,sBAGpEC,UAAYlB,SAASc,cAAc,oBACpCI,UAAUH,QACXG,UAAUH,MAAQJ,MAAMC,KAAKK,iBAG7BlB,QACAA,MAAMoB,OACNpB,MAAMqB"}