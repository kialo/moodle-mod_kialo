{"version":3,"file":"deeplink_setup_modal.min.js","sources":["../src/deeplink_setup_modal.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Javascript code for module instance settings form.\n *\n * @module      mod_kialo/deeplink_setup_modal\n * @copyright   2025 onwards, Kialo GmbH <support@kialo-edu.com>\n * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {getString} from 'core/str';\n\n/**\n * Given a modal creation function and a deeplink URL, set up the modal\n *\n * @param {function} modalFn - The modal creation function\n * @param {string} deeplinkUrl - The URL for discussion selection in Kialo\n */\nexport const setupModal = async(modalFn, deeplinkUrl) => {\n    let modal;\n    document.getElementById('id_kialo_select_discussion').addEventListener('click', async() => {\n        modal = await modalFn({\n            title: await getString('select_discussion', 'mod_kialo'),\n            body: `<iframe class=\"kialo-iframe\" src=\"${deeplinkUrl}\"></iframe>`,\n            large: true,\n        });\n        modal.getModal().addClass('kialo-modal');\n\n        modal.show();\n    });\n\n    window.addEventListener(\n        'message',\n        (event) => {\n            if (event.data.type !== 'kialo_discussion_selected') {\n                return;\n            }\n\n            // Fill in the deep-linked details.\n            document.querySelector('input[name=discussion_url]').value = event.data.discussionurl;\n            document.querySelector('input[name=discussion_title]').value = event.data.discussiontitle;\n\n            // Prefill activity name based on discussion title if user hasn't entered one yet.\n            const nameInput = document.querySelector('input[name=name]');\n            if (!nameInput.value) {\n                nameInput.value = event.data.discussiontitle;\n            }\n\n            modal.hide();\n            modal.destroy();\n        }\n    );\n};\n"],"names":["async","modalFn","deeplinkUrl","modal","document","getElementById","addEventListener","title","body","large","getModal","addClass","show","window","event","data","type","querySelector","value","discussionurl","discussiontitle","nameInput","hide","destroy"],"mappings":"+LA+B0BA,MAAMC,QAASC,mBACjCC,MACJC,SAASC,eAAe,8BAA8BC,iBAAiB,SAASN,UAC5EG,YAAcF,QAAQ,CAClBM,YAAa,kBAAU,oBAAqB,aAC5CC,iDAA2CN,2BAC3CO,OAAO,IAEXN,MAAMO,WAAWC,SAAS,eAE1BR,MAAMS,UAGVC,OAAOP,iBACH,WACCQ,WAC2B,8BAApBA,MAAMC,KAAKC,YAKfZ,SAASa,cAAc,8BAA8BC,MAAQJ,MAAMC,KAAKI,cACxEf,SAASa,cAAc,gCAAgCC,MAAQJ,MAAMC,KAAKK,sBAGpEC,UAAYjB,SAASa,cAAc,oBACpCI,UAAUH,QACXG,UAAUH,MAAQJ,MAAMC,KAAKK,iBAGjCjB,MAAMmB,OACNnB,MAAMoB"}